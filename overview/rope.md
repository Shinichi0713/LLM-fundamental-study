RoPEスケーリングは、「RoPE（Rotary Positional Encoding）を長いシーケンスでもうまく働かせるための拡張・改良テクニック」のことです。

---

## ✅ そもそもRoPEとは？

Transformerで使われる**位置情報の埋め込み（Positional Encoding）**の一種で、

トークンを複素数平面上の回転として表現します。

### 簡単に言うと

* 従来の学習可能位置埋め込み：位置を直接ベクトルで表す
* RoPE：**トークンベクトルに “回転角” を与えて位置関係を表現**

これにより、

| 特徴                   | 効果                               |
| ---------------------- | ---------------------------------- |
| 相対位置関係を保持     | → 長文で意味関係が崩れにくい      |
| 数式的にシンプル       | → GPU計算と相性が良い             |
| 推論時に長文へ拡張可能 | → 長い上下文処理に有効（LLM必須） |

---

## ✅ RoPEスケーリングとは？

RoPEは高い性能を持ちますが、 **本来は学習時に使った最大長近くまでしか安定しません** 。

> 例えば学習時 4K tokens → 推論時 128K tokens → 精度が低下

この問題を解決し、**学習より遥かに長いシーケンスで性能を維持する技術**がRoPEスケーリングです。

---

## ✅ スケーリングの主な手法

| 手法                                        | 概要                                           | 使われ例                       |
| ------------------------------------------- | ---------------------------------------------- | ------------------------------ |
| **NTKスケーリング**                   | 周波数を非線形に調整し、長距離ロバスト性を向上 | LLaMA系、Mistral               |
| **Dynamic NTK**                       | 入力長に応じ動的にスケール                     | 最新研究モデル                 |
| **YaRN (Yet another RoPE extension)** | 線形＋非線形補正で安定性大                     | LLaMA2・LLaMA3・Qwenなどで主流 |

---

## ✅ イメージ図

RoPEは周波数(回転速度)がトークン位置と共に増加するが、

長文では高周波成分が壊れる → スケールして緩和

```
無スケーリング:
位置上昇 → 角度増加 → 破綻

RoPEスケーリング:
位置上昇 → スケール係数で角度補正 → 安定
```

---

## ✅ 数式のイメージ

RoPEの角周波数 ω を、スケール係数 `s` で変換：

```
θ = pos / s
```

YaRNはさらに非線形補正を組み合わせる方式です。

---

## ✅ 結果：何が良くなるか？

| 改善点           | 効果                          |
| ---------------- | ----------------------------- |
| 長文性能アップ   | 100K〜1M tokensなど超長文対応 |
| 精度劣化の回避   | 長文でも意味が飛ばない        |
| 少ない追加コスト | 実装が軽い                    |

---

## ✅ まとめ

| ポイント         | 内容                            |
| ---------------- | ------------------------------- |
| RoPE             | 回転で位置表現                  |
| 課題             | 長文で劣化                      |
| RoPEスケーリング | 長文でも安定化                  |
| 採用例           | LLaMA, Qwen, Mistralなど主流LLM |

---

必要であれば、**NTK vs YaRNの数式比較例**や

RoPEスケーリングを実装する**PyTorchサンプルコード**も用意します。

続きを知りたい内容はどれですか？

1. NTKスケーリングの数式と実例
2. YaRNの仕組みと数式解説
3. LLM実装におけるRoPEパラメータの選び方
4. グラフで理解するRoPEの周波数挙動

番号で教えてください！
